
SHELL = /bin/sh

# suffix Definitions
.SUFFIXES:                # Delete the default suffixes
.SUFFIXES: .c .cc .o .h .tcc .asm # Define our suffix list
	
.cc.o:
	@echo compiling $< ...
	@$(CXX) $(CXXFLAGS) $(DEFINES) -c $< -o $@ 1>/dev/null

.c.o:
	@echo compiling $< ...
	@$(CC) $(CFLAGS) $(DEFINES) -c $< -o $@ 1>/dev/null
	
.asm.o:
	@echo assembling $< ...
	@$(ASM) $(ASMFLAGS) $(DEFINES) $< -o $@ 1>/dev/null
	
	
ASM    := yasm -f elf
CXX    := g++ -march=native -ansi
CC     := gcc -march=native -ansi
LD     := g++
RM     := rm -f
ED     := ed
RES	   := xres

APPNAME := pretendo

DEFINES  := 
INCLUDES := -I. -Imappers -I/boot/common/include/libxml2 -Ilibines -Ip6502 -isystem boost
ASMFLAGS :=
CXXFLAGS := -gdwarf-2 -gstrict-dwarf -O2 -pedantic -pipe $(INCLUDES) -W -Wall -Wno-long-long #-fomit-frame-pointer
CFLAGS   := -gdwarf-2 -gstrict-dwarf -O2 -pedantic -pipe $(INCLUDES) -W -Wall -Wno-long-long #-fomit-frame-pointer
LDFLAGS  := -gdwarf-2 -gstrict-dwarf -lbe -lroot -ltranslation -ltracker -lmedia -lgame -L/boot/common/lib -lxml2

ASM_FILES   := \
	haiku/blitters.asm \
	haiku/copies.asm
				

H_FILES     := \
	APU.h \
	mappers/BNROM.h \
	Bandai.h \
	Cart.h \
	Config.h \
	Controller.h \
	DMC.h \
	Envelope.h \
	Input.h \
	LFSR.h \
	LengthCounter.h \
	LinearCounter.h \
	mappers/MMC3.h \
	Mapper.h \
	mappers/Mapper000.h \
	mappers/Mapper001.h \
	mappers/Mapper002.h \
	mappers/Mapper003.h \
	mappers/Mapper004.h \
	mappers/Mapper005.h \
	mappers/Mapper007.h \
	mappers/Mapper009.h \
	mappers/Mapper010.h \
	mappers/Mapper011.h \
	mappers/Mapper013.h \
	mappers/Mapper015.h \
	mappers/Mapper016.h \
	mappers/Mapper018.h \
	mappers/Mapper019.h \
	mappers/Mapper021.h \
	mappers/Mapper022.h \
	mappers/Mapper023.h \
	mappers/Mapper024.h \
	mappers/Mapper025.h \
	mappers/Mapper026.h \
	mappers/Mapper027.h \
	mappers/Mapper032.h \
	mappers/Mapper033.h \
	mappers/Mapper034.h \
	mappers/Mapper040.h \
	mappers/Mapper041.h \
	mappers/Mapper043.h \
	mappers/Mapper046.h \
	mappers/Mapper048.h \
	mappers/Mapper050.h \
	mappers/Mapper057.h \
	mappers/Mapper058.h \
	mappers/Mapper061.h \
	mappers/Mapper064.h \
	mappers/Mapper066.h \
	mappers/Mapper068.h \
	mappers/Mapper069.h \
	mappers/Mapper071.h \
	mappers/Mapper075.h \
	mappers/Mapper076.h \
	mappers/Mapper079.h \
	mappers/Mapper086.h \
	mappers/Mapper090.h \
	mappers/Mapper113.h \
	mappers/Mapper118.h \
	mappers/Mapper144.h \
	mappers/Mapper159.h \
	mappers/Mapper163.h \
	mappers/Mapper180.h \
	mappers/Mapper201.h \
	mappers/Mapper218.h \
	mappers/Mapper226.h \
	mappers/Mapper228.h \
	mappers/Mapper231.h \
	mappers/Mapper232.h \
	mappers/Mapper240.h \
	mappers/Mapper241.h \
	mappers/Mapper242.h \
	mappers/Mapper243.h \
	mappers/Mapper245.h \
	NES.h \
	mappers/NINA-001.h \
	Noise.h \
	PPU.h \
	Palette.h \
	Reset.h \
	ShiftRegister.h \
	Sprite.h \
	Square.h \
	Sweep.h \
	Timer.h \
	Triangle.h \
	VRAMBank.h \
	mappers/VRC2.h \
	mappers/VRC4.h \
	mappers/VRC6.h \
	VideoInterface.h \
	glext.h \
	haiku/AboutWindow.h \
	haiku/AudioStream.h \
	haiku/LinkView.h \
	haiku/PretendoApp.h \
	haiku/ROMFilePanel.h \
	haiku/PretendoWindow.h \
	haiku/VideoScreen.h \
	haiku/blitters.h \
	haiku/copies.h \
	haiku/SimpleMutex.h \
	haiku/CartInfoWindow.h \
	haiku/CartInfoView.h \
	haiku/PaletteWindow.h \
	haiku/PaletteView.h \
	AudioView.h

CXX_FILES   := \
	APU.cc \
	mappers/BNROM.cc \
	mappers/Bandai.cc \
	Cart.cc \
	Controller.cc \
	DMC.cc \
	Envelope.cc \
	Input.cc \
	LengthCounter.cc \
	LinearCounter.cc \
	mappers/MMC3.cc \
	Mapper.cc \
	mappers/Mapper000.cc \
	mappers/Mapper001.cc \
	mappers/Mapper002.cc \
	mappers/Mapper003.cc \
	mappers/Mapper004.cc \
	mappers/Mapper005.cc \
	mappers/Mapper007.cc \
	mappers/Mapper009.cc \
	mappers/Mapper010.cc \
	mappers/Mapper011.cc \
	mappers/Mapper013.cc \
	mappers/Mapper015.cc \
	mappers/Mapper016.cc \
	mappers/Mapper018.cc \
	mappers/Mapper019.cc \
	mappers/Mapper021.cc \
	mappers/Mapper022.cc \
	mappers/Mapper023.cc \
	mappers/Mapper024.cc \
	mappers/Mapper025.cc \
	mappers/Mapper026.cc \
	mappers/Mapper027.cc \
	mappers/Mapper032.cc \
	mappers/Mapper033.cc \
	mappers/Mapper034.cc \
	mappers/Mapper040.cc \
	mappers/Mapper041.cc \
	mappers/Mapper043.cc \
	mappers/Mapper046.cc \
	mappers/Mapper048.cc \
	mappers/Mapper050.cc \
	mappers/Mapper057.cc \
	mappers/Mapper058.cc \
	mappers/Mapper061.cc \
	mappers/Mapper064.cc \
	mappers/Mapper066.cc \
	mappers/Mapper068.cc \
	mappers/Mapper069.cc \
	mappers/Mapper071.cc \
	mappers/Mapper075.cc \
	mappers/Mapper076.cc \
	mappers/Mapper079.cc \
	mappers/Mapper086.cc \
	mappers/Mapper090.cc \
	mappers/Mapper113.cc \
	mappers/Mapper118.cc \
	mappers/Mapper144.cc \
	mappers/Mapper159.cc \
	mappers/Mapper163.cc \
	mappers/Mapper180.cc \
	mappers/Mapper201.cc \
	mappers/Mapper218.cc \
	mappers/Mapper226.cc \
	mappers/Mapper228.cc \
	mappers/Mapper231.cc \
	mappers/Mapper232.cc \
	mappers/Mapper240.cc \
	mappers/Mapper241.cc \
	mappers/Mapper242.cc \
	mappers/Mapper243.cc \
	mappers/Mapper245.cc \
	NES.cc \
	mappers/NINA-001.cc \
	Noise.cc \
	PPU.cc \
	Palette.cc \
	Square.cc \
	Sweep.cc \
	Timer.cc \
	Triangle.cc \
	mappers/VRC2.cc \
	mappers/VRC4.cc \
	mappers/VRC6.cc \
	p6502/CPU.cc \
	p6502/P6502.cc \
	Config.cc \
	haiku/AboutWindow.cc \
	haiku/AudioStream.cc \
	haiku/HaikuMain.cc \
	haiku/LinkView.cc \
	haiku/PretendoApp.cc \
	haiku/ROMFilePanel.cc \
	haiku/PretendoWindow.cc \
	haiku/VideoScreen.cc \
	haiku/SimpleMutex.cc \
	haiku/CartInfoWindow.cc \
	haiku/CartInfoView.cc \
	haiku/PaletteWindow.cc \
	haiku/PaletteView.cc \
	haiku/AudioView.cc
	
C_FILES     := \
	libines/ines_crc32.c \
	libines/lib_ines.c \
	libines/load_ines.c
	
RES_FILES	:=  \
	pretendo.rsrc

O_FILES     := $(CXX_FILES:.cc=.o) $(ASM_FILES:.asm=.o) $(C_FILES:.c=.o)
SOURCEFILES := $(H_FILES) $(CXX_FILES) $(ASM_FILES)
.PRECIOUS: $(SOURCEFILES)
.PHONY:    clean distclean mrproper

# main targets
all: $(APPNAME)

$(APPNAME): $(O_FILES)
	@echo linking $@ ...
	@$(LD) $(LDFLAGS) $(O_FILES) -o $@ 1>/dev/null
	$(RES) -o $@ $(RES_FILES)

mrproper: clean
	$(RM) makedep

clean:
	$(RM) $(O_FILES) $(APPNAME) core *~ 2> /dev/null

distclean: mrproper
	
depend:
	@echo "Building Dependency Information..."
	@$(RM) makedep
	@$(CXX) $(DEFINES) $(INCLUDES) -MM $(CXX_FILES) 2>/dev/null >> makedep || true
	@echo '/^# DO NOT DELETE THIS LINE/+2,$$d' >eddep
	@echo '$$r makedep' >>eddep
	@echo 'w' >>eddep
	@$(ED) - Makefile.haiku < eddep
	@$(RM) eddep makedep 
	@echo '# DEPENDENCIES MUST END AT END OF FILE' >> Makefile.haiku
	@echo '# IF YOU PUT STUFF HERE IT WILL GO AWAY' >> Makefile.haiku
	@echo '# see make depend above' >> Makefile.haiku
	@echo "Done"
        
#-----------------------------------------------------------------
# DO NOT DELETE THIS LINE -- make depend uses it
#-----------------------------------------------------------------
# DEPENDENCIES MUST END AT END OF FILE
# IF YOU PUT STUFF HERE IT WILL GO AWAY
# see make depend above
